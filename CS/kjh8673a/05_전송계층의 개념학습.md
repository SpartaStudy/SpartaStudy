**전송계층의 개념학습**

<br>

## 전송계층(Transport Layer)

전송계층은 OS 내부에 구현되어있다. TCP, UDP가 있다.

전송계층은 애플리케이션에서 전달하고자하는 메시지를 받아서 다른편에 있는 애플리케이션에 전달하는 역할을 한다.

메시지가 전송계층으로 내려오게 되면 세그먼트라는 전송 단위에 담긴다. 세그먼트는 메시지를 담는 데이터부분과 부가적인 정보(메타데이터 등)를 담고있는 헤더부분으로 구성된다.

세그먼트가 아래계층인 네트워크계층으로 내려가게되면 네트워크계층의 전송단위인 패킷에 담긴다. 패킷도 헤더와 데이터부분으로 구성된다.

TCP는 메시지가 유실되거나 수정되지 않고 보낸 순서대로 전달이 된다. 이를 위해 어떤 속도로 정보를 보낼것인가 결정해야 한다.

- flow control: 상대방이 감당할 수 있는 속도에 맞춰서 전달한다.
- congestion control: 현재 네트워크 상태를 판단하여 속도를 결정한다.

UDP는 속도 결정 단계가 없기 때문에 유실이 될수도, 순서가 바뀔수도 있다.

### multiplexing / demultiplexing

한 컴퓨터 안에서 프로세스들이 각자의 소켓을 갖고 있는데 여러군데에서 하나의 통로로 정보를 보내는 것을 multipexing이라고 한다.

반대로 demultiplexing은 하나의 통로로 온 정보를 여러군데로 나누는 것이다. 어느 소켓으로 보낼지에 대한 결정은 헤더에 담고있는 포트 번호를 이용해 결정한다.

UDP에서는 목적지port가 같으면 demultiplexing되어 한 곳으로 들어간다.

TCP는 소스IP/포트, 목적지IP/포트를 보고 판단한다. 이 중 하나만 달라도 다른것으로 판단하여 demultiplexing하지 않는다.

- 체크섬: 헤더에 들어있는 정보. 중간에 데이터에 에러(유실/변경)가 생겼는지 알 수 있게 해준다.

## Reliable Data Transfer

### 1.0

패킷 유실도, 에러도 없는 상황이라면 사용자로부터 데이터를 받아 패킷으로 만들어서 보내기만 하면 된다.

### 2.0

패킷 에러가 발생할 수 있는 네트워크에서 동작한다면 체크섬을 이용해 에러검증을 해야한다. 검증 후 ACK, NAK과 같은 피드백을 전달하고 재전송 여부를 결정한다.
Error Detection -> Feedback -> reTransmission

### 2.1

에러가 발생했을 때 재전송을 무작정 하면안된다. 중복이 발생할 수 있기 때문이다. 따라서, 패킷이 새로운 데이터인지, 재전송하는 데이터인지 확인할 수 있도록 시퀀스 넘버를 사용한다.

### 2.2
에러가 발생했을 때, NAK을 보내는 대신에 ACK에 시퀀스넘버를 적용하여 가장 최근에 받은 정상적인 번호와 ACK를 전송한다.