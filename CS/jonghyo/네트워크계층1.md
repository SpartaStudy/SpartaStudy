# 네트워크 계층1

### 전송계층

- 프로세스와 프로세스 간의 정보 전달을 어떻게 하면 신뢰성 있게 할지 양 끝단에 대한 이야기였음.

### 네트워크 계층

- 실제로 세그먼트가 어떠한 경로로 전달 되는지 이야기 함.
- 현존하는 라우터는 네트워크 계층 까지만 구성 되어있다.
    - 즉 TCP 세그먼트는 알수 없지만 패킷을 받았을 땐 어떻게 처리할 지 알수 있다.

### 라우터

- 기능
    - **Fowarding**
        - 단순히 패킷을 받아 패킷의 목적지를 보고 그 목적지로 향하는 다음 라우터로 전달하는 것.
    - **Fowarding table**
        - Forwarding 테이블은 라우팅 알고리즘을 통해 만든다.
        - 와일드 카드를 사용하여 어느 부분만 맞으면 해당 라우터로 보냄.
        - 와일드 카드 때문에 여러군데 매칭이 생길 수 있는데 항상 가장 길게 매칭되는 부분에 보낸다. (**longest prefix matching**)
    - **Routing**
        - 특정 출발지에서 특정 목적지까지 어떤 경로를 따라서 가는지에 대한 결정을 하는 것.
    - **Router**
        - 라우팅을 담당하는 프로세스가 있고 들어오는 포트, 나가는 포트 존재.
            - 들어오는 포트(Input port)에서 패킷을 받게 되고 여기서 패킷 헤더에 적힌 목적지 주소를 보고 그 목적지 주소와 매칭이 되는 포워딩 테이블 엔트리를 찾아 그 엔트리에 적힌 아웃풋 링크로 보내주는 역할을 함.
        - 유저의 데이터를 받고 보냄.
        

### IP 데이터 그램

- ver : IP 프로토콜 버전
- head length : 헤더의 크기
- type of service : 타입의 데이터
- time to live : 패킷이 출발지로 부터 발송된 이후에 얼만큼 많은 라우터를 거칠 수 있는지 알려줌. (라우터를 거칠때 마다 1씩 감소)
    - 잘못된 경로를 따라가다 무한대로 계속 돌 경우를 대비해 만듦.
- upper layer : TCP로 올릴지 UDP로 올릴지 알려주는 곳.
- length : 전체 크기
- 16-bit identifier, flags, fragment offset : fragmentation 기능을 위해 사용.
- checksum : 에러 발생감지를 위해 사용
- 헤더는 보통 20~40 바이트 정도의 크기를 가짐.
- 인터넷에서 실제 IP 패킷을 보면 많은 IP 패킷의 크기가 40바이트 짜리임. ⇒ 이건 TCP ACK

### IP Address (IPv4)

- 현재 우리가 사용하고 있는 IP 주소
- 32비트 크기의 주소.
- 8비트씩 4번으로 끊어서 10진수로 표현해 사용(127.127.128.128)이런식
- 계층화 시켜서 주소를 저장한다.
    - 앞부분은 네트워크 주소, 뒷부분은 그 네트워크에 속한 호스트 주소.
    - ex) 12.34.158.0/24 에서 /뒤에 쓰여있는 24가 네트워크 주소 비트 수를 의미함.
    - 이전엔 클래스가 존재.
        - Class A : 0*
            - 0으로 시작하는 건 전부 클래스 A ⇒ 127개 존재. 2의 24승개가 호스트의 개수
        - Class B : 10*
            - 2의 16승개가 호스트의 개수
        - Class C : 110*
            - 2의 8승개가 호스트의 개수.
        - Class D : 1110*
        - Class E : 11110*
    - 최근엔 Classless 방식을 사용함. Class와 전혀 상관없이 Network number = IP 주소 + Mask
- 포워딩 테이블에 적힌 엔트리의 값은 네트워크 prefix의 값임. prefix값은 다 상이함.

### Subnet(서브넷)

- 중간에 라우터를 거치지 않고 갈 수 있는 애들의 집합.
    - 당연히 서브넷 파트에 해당하는 주소가 같다.
- 라우터를 넘어가게 되면 다른 서브넷.

IP주소는 호스트를 지칭하는게 아니라 인터페이스를 지칭하는 것이다.

⇒ 인터페이스 마다 IP 주소를 가지고 있다, 라우터는 인터페이스가 여러개 있음. 서로 다른 IP 주소를 가지고 있음. ex) LAN카드 생각.