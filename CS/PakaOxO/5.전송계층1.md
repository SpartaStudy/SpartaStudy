## 5. 전송 게층 1

&nbsp;&nbsp;지금까지 애플리케이션에서 주고 받는 요청과 응답에 대해 살펴보았다면, 이번에는 애플리케이션이 메시지를 주고 받기 위해 거치게 되는 OS 내부의 `전송 계층(Transport layer)`에 대해 살펴보겠습니다.

&nbsp;&nbsp;애플리케이션으로부터 전달된 메시지는 전송계층 내부의 `세그먼트(Segment)`에 부가정보를 명시한 `Header`의 `Metadata`와 실제 메시지의 내용을 담은 `Data`의 형태로 담기게 됩니다. 세그먼트는 전송계층의 전송단위입니다. 전송계층의 세그먼트에 보관된 메시지는 이후 `네트워크 계층`에서 `패킷(Packet)`에 담기게 됩니다.

<br>

### 전송계층 프로토콜(Protocol)

**1. TCP(Transmission Control Protocol)**

- Reliable, in-order delivery
- Congestion control : 현재 네트워크 상태에 따라 보내는 정보의 속도를 조절하는 기능.
- Flow control : 목적지 컴퓨터(Receiver)가 받아들일 수 있는 속도에 맞게 사용자가 보내는 정보의 속도를 조절하는 기능
- Connection setup

**2. UDP(User Datagram Protocol)**

- Unreliable, unordered deliver

<br>

### Multiplexing/demultiplexing

&nbsp;&nbsp;`Multiplexing`은 `Sender`측에서 여러 소켓으로 전달받은 데이터를 각각의 세그먼트로 포장한 뒤 하나로 내보내는 기능을, `Demultiplexing`은 `Receiver`측에서 전달 받은 데이터를 여러 개의 세그먼트로 분리하여 적절한 소켓(애플리케이션)으로 내보내는 기능을 의미하며 `전송 계층`에서 제공하는 기능입니다.

&nbsp;&nbsp;`Demultiplexing`에서 각각의 세그먼트를 어떤 소켓으로 보내줄지 결정하기 위해 필요한 요소가 바로 `포트 번호(port number)`입니다. 세그먼트의 헤더에는 `source port`와 `dest port`의 정보를 담고 있으며, 각각 해당 세그먼트에 담긴 메시지를 보낸 주체와 목적지의 포트번호를 가지고 있습니다.

<br>

> 💡 **UDP의 Demultiplexing과 TCP의 Demultiplexing**
>
> &nbsp;&nbsp;`UDP`의 `Demultiplexing`은 세그먼트의 `Dest Port`번호만을 참조하여 내보낼 소켓을 결정합니다. 따라서 A와 C의 컴퓨터가 B라는 컴퓨터에 UDP로 전달한 메시지는 Dest Port가 같다면 Demultiplexing 같은 소켓(애플리케이션)으로 나가게 됩니다.
>
> &nbsp;&nbsp;반면 `TCP`의 `Demultiplexing`은 `Source IP`, `Source Port Number`, `Dest IP`, `Dest Port Number` 4가지 요소를 모두 참조하여 내보낼 소켓을 결정합니다. 때문에 A와 C로부터 TCP로 전달된 메시지는 Source IP 등이 다르기 때문에 B의 전송계층에서 서로 다른 소켓(애플리케이션)으로 나가게 됩니다.
>
> &nbsp;&nbsp;실제로 여러 클라이언트 애플리케이션에서 전달된 메시지는 서버에서 `Demultiplexing`을 통해 여러 소켓(애플리케이션)으로 전달되는 것이 아니라 하나의 애플리케이션에서 분리된 `Thread Server`의 소켓들로 들어가게 됩니다.

<br>

### UDP(User Datagram Protocol)

- Packet loss, unreliable
- unordered deliver
- No handshaking btw UDP sender & receiver
- `Multiplexing/Demultiplexing` 이외의 다른 기능은 제공하지 않습니다.
- UDP의 특수한 성질로 Streaming multimedia, DNS, SNMP 등에서 UDP를 사용합니다.

<br>

### UDP Segment Header

> 💡 통신 메시지에서 Header의 의의
>
> &nbsp;&nbsp;메시지를 감싸고 있는 Packet, Segment들은 모두 메시지의 내용을 담고 있는 `Data(Payload)`와 메타정보를 담고 있는 `Header`를 가지고 있습니다. 이 중에서 사용자에게 필요한 정보는 Data이기 때문에 메타정보의 양이 많을 수록 오버헤드가 커지게 되므로 프로토콜을 설계할 때 헤더에는 꼭 필요한 정보만을 담도록 디자인 되었습니다. 따라서 헤더에 담긴 정보들을 통해 각 프로토콜이 어떤 동작을 하는지 간접적으로 이해할 수 있습니다.

<br>

1. Source Port
2. Dest Port : S/D 두 포트는 Multiplexing/Demultiplexing 기능을 위해 필요합니다.
3. length : bytes of UDP segment including header
4. checksum : 수신(Receiver)측에서 payload에 담긴 정보에 수정이 발생했는지(데이터 전송 중에 오류가 발생했는지)를 확인하기 위한 필드입니다. 문제가 있는 세그먼트는 애플리케이션 계층으로 전달되지 않습니다.

<br>

### TCP(Transmission Control Protocol)

&nbsp;&nbsp;`TCP`는 사용자의 메시지를 수신 측에 반드시 전달한다는 측면에서 reliable하다는 장점이 있지만 실제로 네트워크는 Unreliable channel입니다. 이제 TCP가 어떤 방식으로 Reliable Protocol인지 알아보도록 하겠습니다.

<br>
